SELECT *, SUM(pay_price) AS pay_price, t3.cs_nm, t3.cs_seq
	FROM (
		SELECT aa.cs_seq as cs_seq, aa.division1 as division1, aa.division2 as division2, bb.em_seq as em_seq, aa.m_nm as m_nm, aa.good_type2 as good_type2, aa.cs_m_id as cs_m_id, pay_price, aa.pay_date as pay_date 
		FROM (
--				쿼리2-1 시작		
			SELECT *, SUM(pay_price1) AS pay_price  
			FROM (
--          쿼리1-1 시작 (선택 날짜&날짜타입 별 매출 ) 이미 여기서최신 담당자가 나오는데 굳이b b에서 em_seq를 가오려고 조인 할 필요가 있나 ?
				SELECT * 
				FROM (
--				쿼리 0-1 시작				
					SELECT getcskrname(t1.cs_seq) 'cs_seq', getcomkrname(t1.division1) 'division1', getcomkrname(t1.division2) 'division2', 
							getemkrname(t1.em_seq) 'em_seq', getcomkrname(t1.m_nm) 'm_nm', getcomkrname(t1.good_type2) 'good_type2', 
							t1.cs_m_id, SUM(t1.pay_price) AS pay_price1, LEFT(t1.pay_date, 7)  AS pay_date, MAX(pay_date) AS max_date
					FROM t_contract AS t1 
					WHERE 1 = 1 
					AND t1.pay_date BETWEEN '2022-03-01' AND '2022-06-30'
					AND t1.good_type2 in (586)
					AND t1.em_seq in(1,2,9,10,11,12,20,25,26,33,37,39,43,50,51,57,81,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,212,251,279,278,286,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,336,337,338,339,374,351,352,353,356,357,362,364,369,370,373,389,395,397,399,400,402,441,442,448,449,455,461,465,473,475,488,495,551,642,496,497,566,527,543,556,557,560,577,578,579,580,589,590,591,603,610,611,614,621,632,633,639,641,643,651,652,656,662,665,667,668,672,676,677,679,683,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,732,736,742,743,749,750,751,752,757,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,806,817,818,819,842,843,845,851,853,855,856,857,859,860,863,865,874,875,877,878,879,880,885,887,888,895,898,913,914,915,917,921,923,929,930,933,938,939,940,945,949,950,952,953,954,955,956,957,958,959,960,961,962,963,964,969,970,971,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1012,1018,1020,1025,1026,1028,1029,1030,1031,1040,1047,1048,1049,1050,1053,1055,1056,1057,1063,1064,1065,1066,1067,1068,1069,1073,1077,1085,1092,1094,1097,1104,1105,1106,1107,1109,1113,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1216,1152,1211,1153,1157,1158,1159,1160,1166,1372,1191,1192,1193,1568,1196,1198,1201,1204,1206,1208,1223,1224,1225,1231,1232,1241,1246,1249,1251,1260,1261,1264,1267,1268,1269,1271,1274,1275,1280,1281,1282,1284,1286,1290,1295,1296,1297,1298,1300,1303,1305,1308,1309,1310,1311,1315,1316,1317,1318,1319,1321,1323,1324,1325,1328,1337,1338,1339,1340,1344,1349,1350,1351,1352,1357,1358,1359,1362,1363,1370,1371,1373,1375,1376,1378,1380,1382,1385,1386,1387,1388,1389,1390,1391,1392,1393,1394,1396,1397,1398,1405,1406,1407,1410,1412,1413,1416,1417,1421,1428,1433,1434,1437,1440,1441,1443,1446,1447,1448,1449,1450,1451,1453,1455,1457,1510,1471,1472,1473,1474,1476,1479,1480,1481,1483,1484,1485,1486,1488,1489,1490,1491,1493,1494,1495,1496,1500,1501,1502,1503,1505,1507,1508,1511,1513,1514,1515,1516,1517,1518,1520,1521,1522,1523,1525,1528,1530,1531,1533,1536,1537,1543,1544,1548,1549,1550,1551,1553,1554,1556,1561,1562,1563,1564,1565,1566,1569,1572,1575,1578,1579,1580,1581,1583,1584,1585,1586,1587,1588,1589,1590,1591,1592,1593,1594,1595,1596,1597,1598,1599,1600,1601,1602,1604,1605,1606,1607,1608,1609,1610,1611,1612,1613,1615,1616,1617,1619,1620,1622,1623,1624,1625,1627,1628,1629,1630,1631,1632,1633,1634,1635,1636,1637,1638,1639,1640,1641,1642,1643,1645,1647,1649,1650,1651,1652,1653,1654,1655,1656,1657,1659,1660,1661,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,200929,200930,200931,200932,200933,200935,200936,200937,200938,200939,200940,200941,200942,200943,200945,200944,200946,200947,200948,200949,200950,200951,200952,200953,200954,200955,200956,200957,200958,200959,200960,200962,200963,200964,200966,200967,200968,200969,200970,200971,200972,200973,200975,200976,200977,200978,200985,200979,200980,200981,200982,200983,200984,200986,201024,201003,201023,200990,201017,200987,201016,201025,200988,201041,200989,200997,200998,200999,201001,201037,201032,201004,201005,201006,201008,201009,201010,201011,201012,201014,201015,201033,201018,201020,201021,201022,201026,201027,201028,201029,201030,201031,201034,201038,201039,201042,201044,201045,201046,201047,201048,201049,201050,201051,201052,201054,201053,201055,201058,201059,201060,201061,201062,201063,201064,201065,201066,201067,201068,201069,201071,201072,201073,201076,201077,201080,201081,201082,201083,201086,201087,201088,201089,201090,201091,201092,201093,201094,201095,201096,201097,201098)
					AND t1.sales_type IN ('1','3') 
					AND t1.agree_state = '3' 
					AND t1.del_date IS NULL 
					GROUP BY t1.em_seq, t1.m_nm, t1.cs_m_id, t1.good_type2 , LEFT(t1.pay_date, 7)
--				쿼리 0-1 끝					
				) AS a 	 
				ORDER BY m_nm, cs_m_id, max_date DESC
--          쿼리 1-1 끝 
			) AS b 
			GROUP BY cs_seq, m_nm, cs_m_id, good_type2 ,  pay_date -- cs_seq를 추가함
--				쿼리 2-1 끝 
		) as aa 
		left outer JOIN (
--				쿼리 2-2 시작		 
			SELECT * 
			FROM (
--				쿼리 1-2 시작			 
				SELECT em_seq, m_nm, cs_m_id, pay_date FROM t_contract AS t1
				WHERE 1 = 1 			
				AND t1.pay_date >= '2022-03-01' 
				AND t1.pay_date <= '2022-06-30'
				AND t1.good_type2 in (586)
				AND t1.em_seq in(1,2,9,10,11,12,20,25,26,33,37,39,43,50,51,57,81,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,212,251,279,278,286,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,336,337,338,339,374,351,352,353,356,357,362,364,369,370,373,389,395,397,399,400,402,441,442,448,449,455,461,465,473,475,488,495,551,642,496,497,566,527,543,556,557,560,577,578,579,580,589,590,591,603,610,611,614,621,632,633,639,641,643,651,652,656,662,665,667,668,672,676,677,679,683,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,732,736,742,743,749,750,751,752,757,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,806,817,818,819,842,843,845,851,853,855,856,857,859,860,863,865,874,875,877,878,879,880,885,887,888,895,898,913,914,915,917,921,923,929,930,933,938,939,940,945,949,950,952,953,954,955,956,957,958,959,960,961,962,963,964,969,970,971,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1012,1018,1020,1025,1026,1028,1029,1030,1031,1040,1047,1048,1049,1050,1053,1055,1056,1057,1063,1064,1065,1066,1067,1068,1069,1073,1077,1085,1092,1094,1097,1104,1105,1106,1107,1109,1113,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1216,1152,1211,1153,1157,1158,1159,1160,1166,1372,1191,1192,1193,1568,1196,1198,1201,1204,1206,1208,1223,1224,1225,1231,1232,1241,1246,1249,1251,1260,1261,1264,1267,1268,1269,1271,1274,1275,1280,1281,1282,1284,1286,1290,1295,1296,1297,1298,1300,1303,1305,1308,1309,1310,1311,1315,1316,1317,1318,1319,1321,1323,1324,1325,1328,1337,1338,1339,1340,1344,1349,1350,1351,1352,1357,1358,1359,1362,1363,1370,1371,1373,1375,1376,1378,1380,1382,1385,1386,1387,1388,1389,1390,1391,1392,1393,1394,1396,1397,1398,1405,1406,1407,1410,1412,1413,1416,1417,1421,1428,1433,1434,1437,1440,1441,1443,1446,1447,1448,1449,1450,1451,1453,1455,1457,1510,1471,1472,1473,1474,1476,1479,1480,1481,1483,1484,1485,1486,1488,1489,1490,1491,1493,1494,1495,1496,1500,1501,1502,1503,1505,1507,1508,1511,1513,1514,1515,1516,1517,1518,1520,1521,1522,1523,1525,1528,1530,1531,1533,1536,1537,1543,1544,1548,1549,1550,1551,1553,1554,1556,1561,1562,1563,1564,1565,1566,1569,1572,1575,1578,1579,1580,1581,1583,1584,1585,1586,1587,1588,1589,1590,1591,1592,1593,1594,1595,1596,1597,1598,1599,1600,1601,1602,1604,1605,1606,1607,1608,1609,1610,1611,1612,1613,1615,1616,1617,1619,1620,1622,1623,1624,1625,1627,1628,1629,1630,1631,1632,1633,1634,1635,1636,1637,1638,1639,1640,1641,1642,1643,1645,1647,1649,1650,1651,1652,1653,1654,1655,1656,1657,1659,1660,1661,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,200929,200930,200931,200932,200933,200935,200936,200937,200938,200939,200940,200941,200942,200943,200945,200944,200946,200947,200948,200949,200950,200951,200952,200953,200954,200955,200956,200957,200958,200959,200960,200962,200963,200964,200966,200967,200968,200969,200970,200971,200972,200973,200975,200976,200977,200978,200985,200979,200980,200981,200982,200983,200984,200986,201024,201003,201023,200990,201017,200987,201016,201025,200988,201041,200989,200997,200998,200999,201001,201037,201032,201004,201005,201006,201008,201009,201010,201011,201012,201014,201015,201033,201018,201020,201021,201022,201026,201027,201028,201029,201030,201031,201034,201038,201039,201042,201044,201045,201046,201047,201048,201049,201050,201051,201052,201054,201053,201055,201058,201059,201060,201061,201062,201063,201064,201065,201066,201067,201068,201069,201071,201072,201073,201076,201077,201080,201081,201082,201083,201086,201087,201088,201089,201090,201091,201092,201093,201094,201095,201096,201097,201098)			
				AND t1.sales_type IN ('1','3') 			
				AND t1.agree_state = '3' 			
				AND t1.del_date IS NULL 	
				ORDER BY pay_date DESC
--				쿼리 1-2 끝				 
			) AS a 
			GROUP BY m_nm, cs_m_id
--				쿼리 2-2 끝		 	 
		) AS bb ON aa.m_nm=bb.m_nm AND aa.cs_m_id=bb.cs_m_id
	) AS c  
left outer join t_customer AS t3 ON c.cs_seq=t3.cs_seq
GROUP BY m_nm, cs_m_id, good_type2 ,  pay_date;